<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Flipper Zero Firmware: Unit tests</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Flipper Zero Firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs__unit_tests.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Unit tests </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md152"></a>
Intro</h1>
<p >Unit tests are special pieces of code that apply known inputs to the feature code and check the results to see if they are correct. They are crucial for writing robust, bug-free code.</p>
<p >Flipper Zero firmware includes a separate application called <a href="/applications/debug/unit_tests">unit_tests</a>. It is run directly on Flipper devices in order to employ their hardware features and rule out any platform-related differences.</p>
<p >When contributing code to the Flipper Zero firmware, it is highly desirable to supply unit tests along with the proposed features. Running existing unit tests is useful to ensure that the new code doesn't introduce any regressions.</p>
<h1><a class="anchor" id="autotoc_md153"></a>
Running unit tests</h1>
<p >To run the unit tests, follow these steps:</p>
<ol type="1">
<li>Compile the firmware with the tests enabled: <code>./fbt FIRMWARE_APP_SET=unit_tests</code>.</li>
<li>Flash the firmware using your preferred method.</li>
<li>Copy the <a href="assets/unit_tests">assets/unit_tests</a> folder to the root of your Flipper Zero's SD card.</li>
<li>Launch the CLI session and run the <code>unit_tests</code> command.</li>
</ol>
<p ><b>NOTE:</b> To run a particular test (and skip all others), specify its name as the command argument. See <a href="applications/debug/unit_tests/test_index.c">test_index.c</a> for the complete list of test names.</p>
<h1><a class="anchor" id="autotoc_md154"></a>
Adding unit tests</h1>
<h2><a class="anchor" id="autotoc_md155"></a>
General</h2>
<h3><a class="anchor" id="autotoc_md156"></a>
Entry point</h3>
<p >The common entry point for all tests is the <a href="applications/debug/unit_tests">unit_tests</a> application. Test-specific code is placed into an arbitrarily named subdirectory and is then called from the <a href="applications/debug/unit_tests/test_index.c">test_index.c</a> source file.</p>
<h3><a class="anchor" id="autotoc_md157"></a>
Test assets</h3>
<p >Some unit tests require external data in order to function. These files (commonly called assets) reside in the <a href="/assets/unit_tests">assets/unit_tests</a> directory in their respective subdirectories. Asset files can be of any type (plain text, <a class="el" href="struct_flipper_format.html">FlipperFormat</a> (FFF), binary, etc.).</p>
<h2><a class="anchor" id="autotoc_md158"></a>
Application-specific</h2>
<h3><a class="anchor" id="autotoc_md159"></a>
Infrared</h3>
<p >Each infrared protocol has a corresponding set of unit tests, so it makes sense to implement one when adding support for a new protocol. To add unit tests for your protocol, follow these steps:</p>
<ol type="1">
<li>Create a file named <code>test_&lt;your_protocol_name&gt;.irtest</code> in the <a href="assets/unit_tests/infrared">assets</a> directory.</li>
<li>Fill it with the test data (more on it below).</li>
<li>Add the test code to <a href="applications/debug/unit_tests/infrared/infrared_test.c">infrared_test.c</a>.</li>
<li>Update the <a href="assets/unit_tests/infrared">assets</a> on your Flipper Zero and run the tests to see if they pass.</li>
</ol>
<h4><a class="anchor" id="autotoc_md160"></a>
Test data format</h4>
<p >Each unit test has three sections:</p>
<ol type="1">
<li><code>decoder</code> - takes in a raw signal and outputs decoded messages.</li>
<li><code>encoder</code> - takes in decoded messages and outputs a raw signal.</li>
<li><code>encoder_decoder</code> - takes in decoded messages, turns them into a raw signal, and then decodes again.</li>
</ol>
<p ><a class="el" href="struct_infrared.html">Infrared</a> test asset files have an <code>.irtest</code> extension and are regular <code>.ir</code> files with a few additions. Decoder input data has signal names <code>decoder_input_N</code>, where N is a test sequence number. Expected data goes under the name <code>decoder_expected_N</code>. When testing the encoder, these two are switched.</p>
<p >Decoded data is represented in arrays (since a single raw signal may be decoded into several messages). If there is only one signal, then it has to be an array of size 1. Use the existing files as syntax examples.</p>
<h4><a class="anchor" id="autotoc_md161"></a>
Getting raw signals</h4>
<p >Recording raw IR signals are possible using the Flipper Zero. Launch the CLI session, run <code>ir rx raw</code>, then point the remote towards Flipper's receiver and send the signals. The raw signal data will be printed to the console in a convenient format. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
